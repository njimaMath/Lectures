<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>確率変数の期待値の定義を考える</title>

  <!-- Softer tone / relaxed magazine style -->
  <style>
    :root{
      --ink:#1a1a1a;
      --sub:#6b6b6b;
      --accent:#6b2e2e;
      --rule:#e8e7e5;
      --bg:#fffaf6;
      --card-bg:#ffffff;
      --serif: "Noto Serif JP","Yu Mincho","Hiragino Mincho ProN","Source Han Serif","MS PMincho",serif;
      --sans: "Noto Sans JP","Yu Gothic","Hiragino Kaku Gothic ProN","Meiryo",sans-serif;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --max: 820px;
      --radius: 12px;
      --gap: 16px;
    }

    html,body{
      background: var(--bg);
      color: var(--ink);
      margin:0;
      padding:0;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      font-family: var(--serif);
    }

    header{
      background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.85));
      box-shadow: 0 1px 0 rgba(19,19,19,0.03);
      position: sticky;
      top:0;
      z-index: 10;
      backdrop-filter: blur(3px);
    }
    .masthead{
      max-width: var(--max);
      margin: 0 auto;
      padding: 12px var(--gap);
      display:flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
      font-family: var(--sans);
    }
    .brand{
      font-size: 16px;
      color: var(--accent);
      font-weight: 600;
      letter-spacing: 0.06em;
      background: linear-gradient(90deg, rgba(107,46,46,0.06), transparent);
      padding: 6px 10px;
      border-radius: 8px;
    }
    .section{
      font-size: 13px;
      color: var(--sub);
      padding: 6px 8px;
      border-radius: 8px;
      background: rgba(0,0,0,0.02);
      margin-left: auto;
    }

    main{
      max-width: var(--max);
      margin: 22px auto;
      padding: 20px var(--gap) 72px;
    }

    h1{
      font-family: var(--serif);
      font-size: 30px;
      line-height: 1.28;
      font-weight:700;
      margin: 6px 0 6px;
      color: var(--ink);
    }
    .dek{
      font-family: var(--sans);
      font-size: 15px;
      color: var(--sub);
      margin: 8px 0 14px;
    }
    .meta{
      font-family: var(--sans);
      font-size: 13px;
      color: var(--sub);
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom: 18px;
    }
    .meta div{ padding:6px 10px; background: rgba(0,0,0,0.02); border-radius:8px; }

    article{
      font-family: var(--serif);
      font-size: 17px;
      line-height: 1.9;
      color: var(--ink);
      background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.98));
      padding: 20px;
      border-radius: var(--radius);
      box-shadow: 0 8px 20px rgba(16,16,16,0.03);
      border: 1px solid var(--rule);
    }

    p{ margin: 0 0 1.05em; }

    .lead{
      position: relative;
      padding-top: 4px;
    }
    .lead::first-letter{
      float:left;
      font-size: 36px;
      line-height: 1;
      padding-right: 8px;
      padding-top: 2px;
      font-family: var(--serif);
      font-weight: 700;
      color: var(--accent);
      background: rgba(107,46,46,0.04);
      border-radius: 6px;
      padding-left: 6px;
      padding-right: 6px;
      margin-right: 8px;
    }

    h2{
      font-family: var(--sans);
      font-size: 15px;
      font-weight: 700;
      color: rgba(0,0,0,0.92);
      margin: 24px 0 8px;
      padding-bottom: 6px;
      border-bottom: 1px dashed var(--rule);
    }

    .eq{
      text-align: center;
      margin: 14px auto;
      padding: 10px 16px;
      font-family: var(--serif);
      background: #fcfcfc;
      border: 1px solid var(--rule);
      border-radius: 8px;
      max-width: 640px;
    }

    .theorem{
      border-left: 4px solid var(--accent);
      background: #fff;
      padding: 14px 16px;
      margin: 16px 0;
      border-radius: 8px;
    }
    .theorem .label{
      font-family: var(--sans);
      font-size: 12px;
      font-weight:700;
      color: var(--accent);
      display:inline-block;
      margin-bottom:6px;
    }

    .note{
      font-family: var(--sans);
      font-size: 14px;
      color: var(--sub);
      padding-left:10px;
      margin: 8px 0 0;
    }

    .pull{
      font-family: var(--serif);
      font-size: 16px;
      line-height:1.9;
      color:#333;
      background: linear-gradient(90deg, rgba(107,46,46,0.03), rgba(0,0,0,0.01));
      padding:12px 14px;
      margin: 14px 0;
      border-radius: 8px;
      border: 1px solid rgba(0,0,0,0.03);
    }

    code, kbd, samp{
      font-family: var(--mono);
      font-size: .95em;
      background:#f6f6f6;
      padding:.12em .34em;
      border-radius:6px;
    }

    .footer-note{
      font-family: var(--sans);
      font-size: 13px;
      color: var(--sub);
      margin-top: 22px;
      padding-top: 12px;
      border-top: 1px dashed var(--rule);
    }

    .sim-card{
      margin: 26px 0;
      padding: 20px;
      border-radius: var(--radius);
      border: 1px solid rgba(107,46,46,0.16);
      background: linear-gradient(145deg, rgba(107,46,46,0.06), rgba(255,255,255,0.95));
      box-shadow: 0 12px 28px rgba(16,16,16,0.06);
      font-family: var(--sans);
    }

    .sim-head{
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 14px;
    }

    .sim-title{
      font-size: 18px;
      font-weight: 600;
      color: var(--accent);
      letter-spacing: 0.04em;
    }

    .sim-button{
      border: none;
      background: var(--accent);
      color: #fff;
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.03em;
      padding: 8px 14px;
      border-radius: 999px;
      cursor: pointer;
      transition: transform 0.18s ease, box-shadow 0.18s ease, background 0.18s ease;
    }

    .sim-button:disabled{
      background: rgba(107,46,46,0.38);
      cursor: not-allowed;
      box-shadow: none;
    }

    .sim-button:not(:disabled):hover{
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(107,46,46,0.28);
    }

    .coin-stage{
      display: flex;
      align-items: center;
      justify-content: center;
      height: 130px;
      perspective: 800px;
    }

    .coin{
      position: relative;
      width: 88px;
      height: 88px;
      border-radius: 50%;
      transform-style: preserve-3d;
      background: radial-gradient(circle at 30% 30%, #fff8f5, rgba(107,46,46,0.4));
      box-shadow: 0 10px 24px rgba(16,16,16,0.18);
      transition: transform 0.9s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    .coin::after{
      content: "";
      position: absolute;
      inset: 0;
      border-radius: 50%;
      background: radial-gradient(circle at 70% 30%, rgba(255,255,255,0.75), rgba(107,46,46,0.45));
      transform: translateZ(-4px);
    }

    .coin .face{
      position: absolute;
      inset: 0;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      font-weight: 700;
      letter-spacing: 0.08em;
      color: rgba(255,255,255,0.92);
      text-shadow: 0 2px 4px rgba(0,0,0,0.35);
      backface-visibility: hidden;
    }

    .coin .face.front{
      background: linear-gradient(145deg, rgba(107,46,46,0.85), rgba(107,46,46,0.65));
    }

    .coin .face.back{
      background: linear-gradient(145deg, rgba(38,38,38,0.9), rgba(58,58,58,0.7));
      transform: rotateY(180deg);
    }

    .sim-summary{
      text-align: center;
      font-size: 14px;
      color: var(--sub);
      margin-top: 12px;
    }

    .sim-timeline{
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(92px, 1fr));
      gap: 10px;
      margin-top: 18px;
    }

    .sim-tile{
      padding: 10px;
      border-radius: 10px;
      background: rgba(255,255,255,0.7);
      border: 1px solid rgba(0,0,0,0.05);
      text-align: center;
      font-size: 13px;
      font-weight: 600;
      color: var(--ink);
      opacity: 0.25;
      transform: translateY(6px);
      transition: opacity 0.3s ease, transform 0.3s ease, background 0.3s ease;
    }

    .sim-tile.show{
      opacity: 1;
      transform: translateY(0);
    }

    .sim-tile.heads{
      background: rgba(107,46,46,0.12);
      color: var(--accent);
    }

    .sim-tile.tails{
      background: rgba(0,0,0,0.06);
      color: rgba(58,58,58,0.88);
    }

    .sim-note{
      font-size: 12px;
      color: var(--sub);
      margin-top: 10px;
      text-align: center;
    }

    @media (max-width:520px){
      h1{ font-size: 22px; }
      .masthead{ padding:10px; }
      main{ padding: 16px; }
      article{ padding: 16px; }
      .lead::first-letter{ font-size: 30px; }
    }

    @media print{
      header{ display:none; }
      body{ background: #fff; color: #000; }
      article{ box-shadow:none; border-radius:0; padding:0; border:none; }
    }
  </style>

  <!-- MathJax (use $...$ for inline, $$...$$ for display) -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$','$$'], ['\\[','\\]']],
        tags: 'none'
      },
      svg: {fontCache: 'global'}
    };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>
<body>
  <header>
    <div class="masthead">
      <div class="brand">雑記・確率</div>
      <div class="section">コラム</div>
    </div>
  </header>

  <main>
    <h1>確率変数の期待値の定義を考える</h1>
    <div class="meta">
      <div>寄稿：中島秀太</div>
      <div>2025年10月13日</div>
    </div>

    <article>
      <p class="lead">
        期待値は、離散的な場合には「値 × その確率」の総和で定義される。式で書けば $E[X]=\sum_x x\,P(X=x)$となる。一見自然だが、なぜこれが“期待する値”と呼ばれるのか。本記事では、期待値に概念を深掘ることにする。
      </p>

      <h2>コイン投げの長期平均</h2>
      <p>
       公平なコインを1回投げ、表なら100円、裏なら0円獲得するとする。上記の期待値の計算に基づくとこのゲームの期待値は$0\times (1/2)+100\times (1/2)=50$円となる。一回の結果は0円か100円のどちらかで、50円は出てこないのであるが、この期待値はなにをいみしているのだろうか。
      </p>
      <p>
       意味を与えるために、この試行を繰り返すことにする。 実際$n$ 回繰り返すと、合計金額の $n$ で割った（標本）平均は50円に近づく。回数を増やすほど平均は安定し、50円に近づく。この収束が<strong>大数の法則</strong>であり、期待値が表すのは「長期的な平均」だと言える。
      </p>

      <div class="sim-card" id="coin-sim">
        <div class="sim-head">
          <div class="sim-title">21回のコイントスを体験</div>
          <button class="sim-button" id="sim-replay" type="button">もう一度</button>
        </div>
        <p class="note">自動で21回投げるコインを眺めながら、平均がどのように安定していくかを確かめてみよう。</p>
        <div class="coin-stage">
          <div class="coin" id="coin" style="transform: rotateY(0deg);">
            <div class="face front">H</div>
            <div class="face back">T</div>
          </div>
        </div>
        <div class="sim-summary" id="sim-summary">待機中… ボタンを押すとシミュレーションが始まります。</div>
        <div class="sim-timeline" id="sim-timeline">
          <div class="sim-tile" data-index="1">1投目</div>
          <div class="sim-tile" data-index="2">2投目</div>
          <div class="sim-tile" data-index="3">3投目</div>
          <div class="sim-tile" data-index="4">4投目</div>
          <div class="sim-tile" data-index="5">5投目</div>
          <div class="sim-tile" data-index="6">6投目</div>
          <div class="sim-tile" data-index="7">7投目</div>
          <div class="sim-tile" data-index="8">8投目</div>
          <div class="sim-tile" data-index="9">9投目</div>
          <div class="sim-tile" data-index="10">10投目</div>
          <div class="sim-tile" data-index="11">11投目</div>
          <div class="sim-tile" data-index="12">12投目</div>
          <div class="sim-tile" data-index="13">13投目</div>
          <div class="sim-tile" data-index="14">14投目</div>
          <div class="sim-tile" data-index="15">15投目</div>
          <div class="sim-tile" data-index="16">16投目</div>
          <div class="sim-tile" data-index="17">17投目</div>
          <div class="sim-tile" data-index="18">18投目</div>
          <div class="sim-tile" data-index="19">19投目</div>
          <div class="sim-tile" data-index="20">20投目</div>
          <div class="sim-tile" data-index="21">21投目</div>
        </div>
        <div class="sim-note">※ 公平なコインを仮定。表が出ると100円、裏なら0円とする。</div>
      </div>


      <h2>“期待できる値”とズレる状況</h2>
      <p>
        一方で、非常に小さい確率だが大きな値をとる確率変数の場合、期待値は典型を外す。たとえば、表の確率が1兆分の1で表なら1兆円、裏なら0円もらえるというゲームを
考える。期待値は $1$ 円になるが、実際にはほとんどの試行で0円のままになる。
      </p>
      <p>
        こうした小さな確率で極端な値（アウトライヤーなどと呼ぶ）をもつ確率変数では、中央値（半分の結果がそれ以下・以上、つまり$P(X\geq a),P(X\leq a)\geq 1/2$、となる点）のほうが現実をよく捉える。さらに場合によっては、期待値そのものが発散して定義不能になることすらある。
      </p>

      <h2>それでも期待値を使う理由（要点だけ）</h2>
      <p>
        期待値が重要である理由として、次の２点があげられる。
      </p>
      <ol>
        <li><strong>線形性</strong>：合計の平均は各平均の和（線形性）。複雑な系を部分に分けて扱える。</li>
        <li><strong>計算が易しい</strong>：足し算するだけなので計算が楽</li>
      </ol>

      <h2>指標の使い分け</h2>
      <p>
        長期の平均効果を評価するなら期待値。典型的な一回の規模を知りたいなら中央値。尾のリスクが焦点なら分位点やCVaR。問いに応じて指標を選ぶのが筋で、期待値はその中の万能レンチに近い位置づけになる。
      </p>

      <div class="theorem">
        <div class="label">まとめ</div>
        <div>
多くの教科書では、期待値を「だいたいこのあたりの値が期待される」といった形で柔らかく導入している。しかし実際には、期待値とは「都合がよい代表値」として考えられているにすぎず、現実の結果がその値から大きく離れることも珍しくない。
むしろ現代の確率論の多くの研究では、「期待値からどれだけ、どのように離れるか」を扱うことが主題となっており、その偏りの分布や典型的な値（例えば中央値）をいかに正確に捉えるかが重要な関心となっている。
        </div>
      </div>
    </article>
  </main>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const coin = document.getElementById('coin');
      const timeline = Array.from(document.querySelectorAll('.sim-tile'));
      const summary = document.getElementById('sim-summary');
      const replayButton = document.getElementById('sim-replay');
      const totalFlips = 21;
      const rewardHeads = 100;
      const rewardTails = 0;
      let spinAngle = 0;
      let timerId = null;

      const resetTiles = () => {
        timeline.forEach((tile) => {
          tile.classList.remove('show', 'heads', 'tails');
          tile.textContent = `${tile.dataset.index}投目`;
        });
      };

      const stopTimer = () => {
        if (timerId) {
          clearTimeout(timerId);
          timerId = null;
        }
      };

      const updateSummary = (heads, tails, flipsDone) => {
        if (flipsDone === 0) {
          summary.textContent = 'シミュレーション中…';
          return;
        }

        const totalReward = heads * rewardHeads + tails * rewardTails;
        const average = (totalReward / flipsDone).toFixed(1);
        summary.textContent = `表${heads}回 / 裏${tails}回 ｜ 平均獲得額 ${average}円`;
      };

      const runSimulation = () => {
        stopTimer();
        replayButton.disabled = true;
        spinAngle = 0;
        coin.style.transform = 'rotateY(0deg)';
        summary.textContent = 'シミュレーション中…';
        resetTiles();

        let currentFlip = 0;
        let headsCount = 0;
        let tailsCount = 0;

        const flipOnce = () => {
          if (currentFlip >= totalFlips) {
            updateSummary(headsCount, tailsCount, totalFlips);
            replayButton.disabled = false;
            return;
          }

          const outcomeHeads = Math.random() < 0.5;
          spinAngle += 360 + (outcomeHeads ? 0 : 180);
          coin.style.transform = `rotateY(${spinAngle}deg)`;

          if (outcomeHeads) {
            headsCount += 1;
          } else {
            tailsCount += 1;
          }

          const tile = timeline[currentFlip];
          const resultLabel = outcomeHeads ? '表' : '裏';
          const reward = outcomeHeads ? rewardHeads : rewardTails;
          tile.textContent = `${currentFlip + 1}投目：${resultLabel}（${reward}円）`;
          tile.classList.add('show', outcomeHeads ? 'heads' : 'tails');

          currentFlip += 1;
          updateSummary(headsCount, tailsCount, currentFlip);
          timerId = setTimeout(flipOnce, 900);
        };

        timerId = setTimeout(flipOnce, 600);
      };

      replayButton.addEventListener('click', runSimulation);
      runSimulation();

      window.addEventListener('beforeunload', stopTimer);
    });
  </script>
</body>
</html>
